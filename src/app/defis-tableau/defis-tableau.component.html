<main class="container">
	<div class="h1 text-center" id="pageHeaderTitle">Les défis</div>

  <div *ngFor="let defi of (defis$ | async)">
	<article class="postcard yellow">

		<div class="postcard__text">
			<h1 class="postcard__title yellow">{{defi.id}} : {{defi.titre}}</h1>
			<div class="postcard__subtitle small">
					<i class="fas fa-calendar-alt mr-2"></i>{{defi.auteur}}, {{defi.dateDeCreation}}

			</div>
			<div class="postcard__bar"></div>
			<div class="postcard__preview-txt">
        <p>Type : {{defi.nomType}}</p>
        <p>Arrêt : {{defi.codeArret}}</p>
        <p>Points : {{defi.points}}</p>
        <p>Durée : {{defi.duree}} mn</p>
        <p>{{defi.prologue}}</p>

        <ng-container *ngIf="defi.id == 'D127'" >
          <div class="info">
            <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
            <strong> Info ! </strong> Pour le présentiel regarder la vidéo avant d'aller sur place.
          </div>
          <iframe width="500" height="250" src="https://www.youtube.com/embed/ZbA7aPTmlDY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </ng-container>

        <mat-accordion>
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <b>Afficher les mots clés </b>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div>
              <div *ngFor="let motscles of (motsCles$ | async)">
                <div *ngIf="motscles.defisId === defi.id">
                  <li>{{ motscles.motCle }}</li>
                </div>
              </div>
            </div>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <b>Afficher la Description </b>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <!--TEXTE-->
          <div *ngFor="let bloc of (bloctexte$ | async)">
            <div *ngIf="bloc.defisId === defi.id">
              <p class="text"> {{ bloc.texte }} </p>
            </div>

            <!--INDICES-->
            <div *ngFor="let indice of (indices$ |async)">
              <div *ngIf="indice.defisId === defi.id && bloc.questionsId === indice.indicesId">
                <b class="titre"> Indice {{ indice.indiceNum }}: </b>
                <b> ({{indice.points}} points)</b>
                <p> {{ indice.description }} </p>
              </div>
            </div>

            <!--QUESTIONS-->
            <div *ngFor="let question of (questions$ | async)">
              <div *ngIf="question.defisId === defi.id && bloc.questionsId === question.questionId" >
                <b  class="titre">Question {{ question.questionNum }}: </b>
                <b> ({{ question.points }} points)</b>
                <p> {{ question.description }} </p>
              </div>
            </div>

          </div>
          </mat-expansion-panel>
        </mat-accordion>
        <p></p>
        <div *ngIf="defi.commentaire.length !== 0">
          <p>Commentaires : </p>
          <p>{{defi.commentaire}}</p>
        </div>
        <button mat-raised-button class="boutonVisiter" color="success" (click)="selectionnerDefi(defi)">Visiter</button>
      </div>

		</div>
  </article>
</div>
</main>
